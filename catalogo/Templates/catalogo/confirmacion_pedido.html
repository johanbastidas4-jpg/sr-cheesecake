{% extends "base.html" %}
{% load l10n %}

{% block title %}Confirmaci√≥n de Pedido | Sr. Cheesecake{% endblock %}

{% block content %}
<div class="container my-5 d-flex justify-content-center">

    <div class="card shadow-lg w-65">
        <div class="card-body text-center">

            <!-- Icono de aprobado -->
            <div class="mb-3">
                <span class="display-1 text-success">‚úîÔ∏è</span>
            </div>

            <!-- Mensaje principal -->
            <h2 class="section-title">¬°Pedido registrado con √©xito!</h2>
            <p class="text-muted">Gracias por tu compra, {{ pedido.nombre_cliente }}.</p>

            <!-- ID y fecha -->
            <p class="price"><strong>ID Pedido:</strong> #{{ pedido.id }}</p>
            <p><strong>Fecha:</strong> {{ pedido.creado_en|date:"d/m/Y H:i" }}</p>

            <h4 class="mb-3">Detalles del pedido</h4>
            <!-- Detalles del pedido -->
            
            <ul class="list-group mb-3 text-start">
                {% for detalle in pedido.detalles.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ detalle.producto.nombre }} (x{{ detalle.cantidad }})
                    <span>${{ detalle.subtotal|localize }} COP</span>
                </li>
                {% endfor %}
            </ul>

            <!-- Separador -->
            <hr>

            <!-- Detalles del cliente/env√≠o -->
            <h4 class="mb-3">Datos del cliente y env√≠o</h4>
            <p><strong>Nombre:</strong> {{ pedido.nombre_cliente }}</p>
            <p><strong>Tel√©fono:</strong> {{ pedido.telefono }}</p>
            <p><strong>Direcci√≥n:</strong> {{ pedido.direccion }}</p>

            <!-- Separador -->
            <hr>

            <!-- Monto y m√©todo de pago -->
            <h4 class="mb-3">Pago</h4>
            <p><strong>Subtotal facturado:</strong> ${{ pedido.total|localize }} COP</p>
            <p><strong>Env√≠o: </strong>
                        {% if pedido.total >= 60000 %}
                            <span class="text-success">Gratis</span>
                        {% else %}
                            ${{ 11000|localize }} COP
                        {% endif %}
            </p>
            <p><strong>Total:</strong>
                        {% if pedido.total >= 60000 %}
                            ${{ pedido.total|localize }}
                        {% else %}
                            ${{ pedido.total|add:"11000"|localize }} COP
                        {% endif %}
                    </p>
            </p>


            <p><strong>M√©todo de pago:</strong> {{ pedido.metodo_pago }}</p>
            {% if pedido.metodo_pago == "Transferencia" %}
                <div class="alert alert-info text-start mt-3">
                    <h6 class="mb-2">Datos para transferencia bancaria</h6>
                    <p class="mb-1"><strong>Banco:</strong> Bancolombia</p>
                    <p class="mb-1"><strong>Tipo de cuenta:</strong> Ahorros</p>
                    <p class="mb-1"><strong>N√∫mero de cuenta:</strong> 123-456789-01</p>
                    <p class="mb-1"><strong>Titular:</strong> Sr. Cheesecake</p>
                    <p class="mb-0"><strong>Referencia:</strong> Pedido #{{ pedido.id }}</p>
                </div>
            {% endif %}

            {% if pedido.metodo_pago == "Wompi" %}
                {% if pedido.estado_pago == "pagado" %}
                    <div class="alert alert-success mt-3">
                        Pago aprobado v√≠a Wompi. Gracias por tu compra.
                    </div>
                {% elif pedido.estado_pago == "rechazado" %}
                    <div class="alert alert-danger mt-3">
                        El pago fue rechazado. Si el cargo aparece en tu banco, comun√≠cate con nosotros.
                    </div>
                {% else %}
                    <div class="alert alert-warning mt-3">
                        Estamos procesando la confirmaci√≥n de tu pago.
                    </div>
                {% endif %}
            {% endif %}


            <!-- Separador -->
            <hr>

            <!-- Mensaje pr√≥ximo paso -->

            {% if pedido.metodo_pago == "Transferencia" %}
                <p class="text-muted mt-2">
                    Una vez realices la transferencia, env√≠anos el comprobante por WhatsApp al +57-(322) 233 6338 para procesar tu pedido üì≤
                </p>
            {% else %}
                <p class="text-success">Estamos preparando tu pedido. Te avisaremos cuando est√© en camino üöö</p>
            {% endif %}



            <!-- Barra de progreso -->
            <div class="progress my-4" style="height: 25px;">
                <div class="progress-bar bg-success" role="progressbar" style="width: 25%;">
                    Pedido recibido
                </div>
                <div class="progress-bar bg-secondary" role="progressbar" style="width: 25%;">
                    Preparando
                </div>
                <div class="progress-bar bg-secondary" role="progressbar" style="width: 25%;">
                    En camino
                </div>
                <div class="progress-bar bg-secondary" role="progressbar" style="width: 25%;">
                    Entregado
                </div>
            </div>

            <!-- Botones -->
            <div class="mt-4">
                <a href="{% url 'lista_productos' %}" class="btn btn-primary-custom me-2">Seguir comprando</a>
            </div>
            <div class="mt-4">
                <button class="btn btn-secondary" onclick="window.print()">  
                    Imprimir confirmaci√≥n </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
